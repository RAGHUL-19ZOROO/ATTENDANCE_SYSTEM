<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>LEE ATTENDANCE PORTAL </title>
    <link rel="icon" type="image/png" href="{{ url_for('static', filename='images/logo2.png') }}">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
</head>

<body id="back">
    <div class="container mt-5">

        <div class="time card shadow p-4 rounded-3 m-4 " style="backdrop-filter: blur(3px);">

            <h3 class="text-center mb-3">Class Attendance List</h3>


            <form method="POST" class="row g-2">
                <div class="col-md-4">
                    <input type="date" id="dateinput" name="date" class="form-control" required>
                </div>
                <div class="col-md-2">
                    <button class="btn btn-dark">Search</button>
                </div>
                <select name="hour" class="form-control">
                    <option value="">Full Day</option>
                    <option value="p1">P1</option>
                    <option value="p2">P2</option>
                    <option value="p3">P3</option>
                    <option value="p4">P4</option>
                    <option value="p5">P5</option>
                    <option value="p6">P6</option>
                    <option value="p7">P7</option>
                    <option value="p8">P8</option>
                </select>
                <div class="mt-3">

                    <a href="/export/day?date={{selected_date}}" class="btn btn-success">
                        Download Full Day Excel
                    </a>

                    <a href="/export/last?date={{selected_date}}" class="btn btn-warning">
                        Download Last Hour Excel
                    </a>

                </div>




            </form>
            <h4>Attendance % : {{ percent }}%</h4>


            {% if message %}
            <div class="alert alert-danger">
                {{ message }}
            </div>
            {% endif %}

            {% if students %}
            <h5>Date: {{ selected_date }}</h5>

            <div class="card shadow p-3 rounded-4">

                <table id="studentTable" class="table table-bordered  text-center">

                    <thead class="table-primary">
                        <tr>
                            <th>Student ID</th>
                            <th>Student Name</th>

                            {% if not selected_hour %}
                            <th>Period 1</th>
                            <th>Period 2</th>
                            <th>Period 3</th>
                            <th>Period 4</th>
                            <th>Period 5</th>
                            <th>Period 6</th>
                            <th>Period 7</th>
                            <th>Period 8</th>

                            {% else %}
                           <th>Period {{ selected_period[1:] }}</th>

                            {% endif %}
                        </tr>
                    </thead>


                    <tbody>
                        {% for s in students %}
                        <tr>
                            <td>{{ s.student_id }}</td>
                            <td>{{ s.student_name }}</td>

                            {% if not selected_hour %}
                            <td>{{ s.p1 }}</td>
                            <td>{{ s.p2 }}</td>
                            <td>{{ s.p3 }}</td>
                            <td>{{ s.p4 }}</td>
                            <td>{{ s.p5 }}</td>
                            <td>{{ s.p6 }}</td>
                            <td>{{ s.p7 }}</td>
                            <td>{{ s.p8 }}</td>
                            {% else %}
                            <td>{{ s[selected_hour] }}</td>
                            {% endif %}

                        </tr>
                        {% endfor %}
                    </tbody>


                </table>
                {% endif %}

                <a href="/admin_dashboard" class="btn btn-secondary mt-3">Back</a>

            </div>
            </form>
        </div>
    </div>

    <style>
      body {
            background: #0f172a;
            color: #e5e7eb;
        }
        .time {
            background-color: aliceblue;
            backdrop-filter: blur(3px);
            background-blend-mode: lighten;
            opacity: 0.9;
        }
    </style>

    <script>
        document.getElementById("searchInput").addEventListener("keyup", function () {
            let value = this.value.toLowerCase();
            let rows = document.querySelectorAll("#studentTable tbody tr");

            rows.forEach(function (row) {
                let text = row.innerText.toLowerCase();
                row.style.display = text.includes(value) ? "" : "none";
            });
        });
    </script>
    <script>
        function downloadDay() {
            let d = document.getElementById("dateInput").value
            if (!d) {
                alert("Select date first")
                return
            }
            window.location = "/export/day?date=" + d
        }

        function downloadLast() {
            let d = document.getElementById("dateInput").value
            if (!d) {
                alert("Select date first")
                return
            }
            window.location = "/export/last?date=" + d
        }
    </script>

    <style>
        @media (max-width:700px) {

            .container {
                width: 100% !important;
                padding: 10px !important;
                margin: 0 !important;
            }

            .time {
                margin: 0 !important;
                padding: 15px !important;
                height: min(40px, 100%);
            }

            h3 {
                font-size: 18px;
            }

            .row.mb-3 {
                display: flex;
                flex-direction: column;
                gap: 10px;
            }

            .row.mb-3 .col-md-3 {
                width: 100%;
            }

            button.btn {
                width: 100%;
            }

            table {
                font-size: 12px;
            }

            th,
            td {
                padding: 6px !important;
            }

            .navbar-brand {
                font-size: 14px;
            }

            .navbar img {
                width: 28px;
            }
        }
    </style>
</body>

</html>